<Project ToolsVersion="15.0">
  <Target Name="WriteNugetConfigFile">

      <ItemGroup>
        <NugetConfigPrivateFeeds Include="$(ExternalRestoreSources.Split(';'))" />
      </ItemGroup>

    <PropertyGroup>
      <NugetConfigHeader>
        <![CDATA[
<?xml version="1.0" encoding="utf-8"?>
<configuration>
<packageSources>
<!--To inherit the global NuGet package sources remove the <clear/> line below -->
<clear />
        ]]>
      </NugetConfigHeader>

      <NugetConfigCLIFeeds>
        <![CDATA[
    <add key="BlobFeed" value="https://dotnetfeed.blob.core.windows.net/dotnet-core/index.json" />
    <add key="dotnet-public" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-public/nuget/v3/index.json" />
    <add key="dotnet-tools" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-tools/nuget/v3/index.json" />
    <add key="myget-legacy" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
        ]]>
      </NugetConfigCLIFeeds>

      <NugetConfigSuffix>
        <![CDATA[
</packageSources>
<disabledPackageSources>
   <clear/>
</disabledPackageSources>
</configuration>
        ]]>
      </NugetConfigSuffix>

  </PropertyGroup>

    <WriteLinesToFile File="$(GeneratedNuGetConfig)"
                      Lines="$(NugetConfigHeader)"
                      Overwrite="true" />

    <WriteLinesToFile Condition="'$(ExternalRestoreSources)' != ''"
                      File="$(GeneratedNuGetConfig)"
                      Lines="&lt;add key=&quot;PrivateBlobFeed%(NugetConfigPrivateFeeds.Identity)&quot; value=&quot;%(NugetConfigPrivateFeeds.Identity)&quot; /&gt;"
                      Overwrite="false" />

    <WriteLinesToFile Condition="'$(DotNetBuildOffline)' != 'true'"
                      File="$(GeneratedNuGetConfig)"
                      Lines="$(NugetConfigCLIFeeds)"
                      Overwrite="false" />

    <WriteLinesToFile File="$(GeneratedNuGetConfig)"
                      Lines="$(NugetConfigSuffix)"
                      Overwrite="false" />

  </Target>
</Project>
